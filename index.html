<script>(function(d,z,s){s.src='https://'+d+'/401/'+z;try{(document.body||document.documentElement).appendChild(s)}catch(e){}})('groleegni.net',9629407,document.createElement('script'))</script>
        function updateAdsCountUI() {
             if (!userData) return;
             const today = new Date().toISOString().slice(0, 10);
             const adsWatchedToday = (userData.adsWatched && userData.adsWatched[today]) || 0;
             const adsLeft = DAILY_AD_LIMIT - adsWatchedToday;
             const adsLeftText = document.getElementById('ads-left-text');
             const adsRemainingText = document.getElementById('ads-remaining');
             const startAdButton = document.getElementById('start-ad-btn');
             if (adsLeftText) adsLeftText.innerText = `Watch short ads to earn. (${adsLeft > 0 ? adsLeft : 0} left)`;
             if (adsRemainingText) adsRemainingText.innerText = adsLeft > 0 ? adsLeft : 0;
             if(adsLeft <= 0) {
                if (startAdButton) {
                    startAdButton.disabled = true;
                    startAdButton.classList.add('disabled-button');
                    startAdButton.innerText = 'Daily Limit Reached';
                }
             }
        };
        function updateAllUIElements() {
            if (!userData) return;
            const balanceText = `BDT ${userData.balance.toFixed(2)}`;
            document.getElementById('user-balance').innerText = balanceText;
            document.getElementById('profile-balance').innerText = balanceText;
            document.getElementById('profile-total-earned').innerText = `BDT ${(userData.totalEarned || 0).toFixed(2)}`;
            const totalAdsWatched = Object.values(userData.adsWatched || {}).reduce((sum, count) => sum + count, 0);
            document.getElementById('profile-ads-watched').innerText = totalAdsWatched;
            updateAdsCountUI();
        };
        window.addEventListener('load', async function () {
            updateUI();
            try {
                const noticeRef = doc(db, "settings", "notice");
                const noticeSnap = await getDoc(noticeRef);
                const noticeBar = document.getElementById('notice-bar-text');
                if (noticeBar) {
                    noticeBar.innerText = noticeSnap.exists() ? noticeSnap.data().text : "Welcome to Allinonebd! Happy Earning!";
                }
                const tg = window.Telegram.WebApp;
                if (typeof tg === 'undefined' || !tg.initDataUnsafe || !tg.initDataUnsafe.user) {
                    document.getElementById('user-name').innerText = "Guest User";
                    document.getElementById('user-balance').innerText = "BDT 0.00";
                    return; 
                }
                tg.ready(); 
                currentUser = tg.initDataUnsafe.user;
                if (!currentUser) { throw new Error("User data not found in Telegram initData."); }
                const userId = currentUser.id.toString();
                const userName = currentUser.first_name + (currentUser.last_name ? " " + currentUser.last_name : "");
                userRef = doc(db, "users", userId);
                const docSnap = await getDoc(userRef);
                if (docSnap.exists()) {
                    userData = docSnap.data();
                } else {
                    const newUser = { name: userName, username: currentUser.username || null, balance: 0, pendingReferralBalance: 0, referrals: 0, totalEarned: 0, adsWatched: {}, joinedAt: new Date() };
                    await setDoc(userRef, newUser);
                    userData = newUser;
                }
                document.getElementById('user-name').innerText = userData.name;
                document.getElementById('total-referrals').innerText = userData.referrals || 0;
                document.getElementById('profile-name').innerText = userData.name;
                document.getElementById('profile-username').innerText = currentUser.username ? `@${currentUser.username}` : 'N/A';
                document.getElementById('profile-pending-balance').innerText = `BDT ${(userData.pendingReferralBalance || 0).toFixed(2)}`;
                document.getElementById('profile-total-referrals').innerText = userData.referrals || 0;
                document.getElementById('referral-link').value = `https://t.me/Allinonebdrealbot?start=${userId}`;
                updateAllUIElements();
            } catch (error) {
                console.error("Error during initialization: ", error);
                document.getElementById('user-name').innerText = "Error during load";
                document.getElementById('user-balance').innerText = "BDT 0.00";
            }
            document.getElementById('task-rules-content').innerHTML = rules['en'];
            document.getElementById('referral-note-content').innerHTML = referralNoteLanguages['en'];
        });
        window.copyReferralLink = function() {
            const referralLinkInput = document.getElementById('referral-link');
            referralLinkInput.select();
            referralLinkInput.setSelectionRange(0, 99999);
            try {
                var successful = document.execCommand('copy');
                if (successful) { showToast("Referral link copied!"); }
                else { showToast("Copy failed. Please copy manually."); }
            } catch (err) { showToast("Copy failed. Please copy manually."); }
        };
        window.shareReferralLink = async function() {
            const referralLink = document.getElementById('referral-link').value;
            if (!referralLink || referralLink.includes('Loading')) {
                showToast("Referral link not available yet.");
                return;
            }
            const shareData = {
                title: 'Join Allinonebd',
                text: "Hey! Join me on Allinonebd and start earning rewards! üí∞",
                url: referralLink,
            };
            if (navigator.share) {
                try { await navigator.share(shareData); }
                catch (err) { console.log("Share cancelled or failed", err); }
            } else {
                const telegramShareUrl = `https://t.me/share/url?url=${encodeURIComponent(referralLink)}&text=${encodeURIComponent(shareData.text)}`;
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.openTelegramLink(telegramShareUrl);
                } else {
                    window.open(telegramShareUrl, '_blank');
                }
            }
        };
        const referralNoteLanguages = {
            en: `<p>You will receive a <b>10 BDT</b> bonus when your referred friend meets the following conditions:</p><ul class="list-disc list-inside mt-1"><li><span class="text-red-600 font-bold">Must complete a full 7 days of work.</span></li><li><span class="text-red-600 font-bold">Must work actively for at least 15 days within a month.</span></li></ul><p class="text-xs text-gray-500 mt-2">The bonus will remain in your Pending Balance until the conditions are met.</p>`,
            bn: `<p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø <b>10 BDT</b> ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®:</p><ul class="list-disc list-inside mt-1"><li><span class="text-red-600 font-bold">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß≠ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</span></li><li><span class="text-red-600 font-bold">‡¶è‡¶ï ‡¶Æ‡¶æ‡¶∏‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶ï‡¶Æ‡¶™‡¶ï‡ßç‡¶∑‡ßá ‡ßß‡ß´ ‡¶¶‡¶ø‡¶® ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§</span></li></ul><p class="text-xs text-gray-500 mt-2">‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶®‡¶æ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Pending Balance-‡¶è ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>`
        };
        let currentReferralNoteLang = 'en';
        window.toggleReferralNoteLanguage = function() {
            currentReferralNoteLang = (currentReferralNoteLang === 'en') ? 'bn' : 'en';
            document.getElementById('referral-note-content').innerHTML = referralNoteLanguages[currentReferralNoteLang];
            const toggleButton = document.getElementById('referral-lang-toggle');
            toggleButton.innerText = (currentReferralNoteLang === 'en') ? '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ' : 'English';
        };
        const rules = {
            en: `<ul class="list-disc list-inside mt-4 space-y-2 text-gray-700 bg-yellow-50 border border-yellow-200 p-4 rounded-lg"><li>Using any kind of <b>VPN/Proxy</b> is strictly prohibited.</li><li>Only one user can work from the same <b>Wi-Fi/IP address</b>.</li><li>Your account will be <b>blocked</b> for violating the rules.</li><li>You can use <b>Mobile Data</b> to work if needed.</li></ul><p class="text-sm text-gray-500 mt-2">Our system will check your IP address before starting the task.</p>`,
            bn: `<ul class="list-disc list-inside mt-4 space-y-2 text-gray-700 bg-yellow-50 border border-yellow-200 p-4 rounded-lg"><li>‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ß‡¶∞‡¶®‡ßá‡¶∞ <b>‡¶≠‡¶ø‡¶™‡¶ø‡¶è‡¶®/‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∏‡¶ø</b> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡¶ø‡¶∑‡¶ø‡¶¶‡ßç‡¶ß‡•§</li><li>‡¶è‡¶ï‡¶á <b>‡¶ì‡¶Ø‡¶º‡¶æ‡¶á‡¶´‡¶æ‡¶á/‡¶Ü‡¶á‡¶™‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏</b> ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶è‡¶ï‡¶ú‡¶®‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</li><li>‡¶®‡¶ø‡¶Ø‡¶º‡¶Æ ‡¶≠‡¶ô‡ßç‡¶ó ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø <b>‡¶¨‡ßç‡¶≤‡¶ï</b> ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá‡•§</li><li>‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶ø <b>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶°‡ßá‡¶ü‡¶æ</b> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§</li></ul><p class="text-sm text-gray-500 mt-2">‡¶ï‡¶æ‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶™‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶¨‡ßá‡•§</p>`
        };
        let currentLanguage = 'en';
        window.toggleLanguage = function() {
            currentLanguage = (currentLanguage === 'en') ? 'bn' : 'en';
            document.getElementById('task-rules-content').innerHTML = rules[currentLanguage];
            document.getElementById('lang-toggle').innerText = (currentLanguage === 'en') ? '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ' : 'English';
        };
        window.updateWithdrawUI = function() {
            const method = document.getElementById('withdraw-method').value;
            const label = document.getElementById('withdraw-address-label');
            const input = document.getElementById('withdraw-address');
            if (method === 'payoneer') {
                label.textContent = 'Payoneer Email';
                input.placeholder = 'Enter your Payoneer email';
            } else { 
                label.textContent = 'Account Number';
                input.placeholder = 'e.g., 01700000000';
            }
        };
    </script>
</body>
</html>
